
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>8.2. 선형 회귀모형 &#8212; 빅데이터 개론 2</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystyle.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="8.1. 두 변수의 관계" href="correlation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">빅데이터 개론 2</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   빅데이터 개론 2
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/intro-course.html">
   1. 서론
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/intro-program.html">
     1.1. 프로그래밍 언어
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/intro-stat.html">
     1.2. 통계학
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/intro-python.html">
   2. 파이선의 기초
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/basic-expression.html">
     2.1. 표현식과 변수
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data-processing-intro.html">
     2.2. 데이터의 처리
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data-processing-train-passenger.html">
     2.3. 고속열차 여객 수송자료
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data-processing-text.html">
     2.4. 어린 왕자
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/types.html">
   3. 자료의 형식
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/numbers.html">
     3.1. 숫자
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/string.html">
     3.2. 문자열
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/array.html">
     3.3. 행렬
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/dataframe.html">
   4. 데이터프레임
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dataframe-intro.html">
     4.1. 데이터프레임의 정의와 구성요소
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dataframe-change.html">
     4.2. 데이터프레임의 정리
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dataframe-summary.html">
     4.3. 데이터프레임의 요약
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dataframe-merge.html">
     4.4. 데이터프레임의 결합
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/data-intro.html">
   5. 분포와 확률
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/data_distribution.html">
     5.1. 자료의 분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/data_randomness.html">
     5.2. 분포와 우연성
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/data_random_experiment.html">
     5.3. 확률과 컴퓨터 실험
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/data_probability.html">
     5.4. 확률의 기초
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/data_function.html">
     5.5. 함수
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/sampling-intro.html">
   6. 표본과 경험적 분포
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/sample.html">
     6.1. 표본과 정보
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/samplemeans.html">
     6.2. 통계량의 분포
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/estimator.html">
     6.3. 추정량의 성질
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/bootstrap.html">
     6.4. 붓스트랩
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/test-intro.html">
   7. 유의성 검정
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/decision.html">
     7.1. 선택과 증거
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/pvalue.html">
     7.2. 유의성 검정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/abtest.html">
     7.3. 두 그룹의 비교
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="relation-intro.html">
   8. 관계와 예측
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="correlation.html">
     8.1. 두 변수의 관계
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     8.2. 선형 회귀모형
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/08/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/UOS-Bigdata/bigdatabook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/UOS-Bigdata/bigdatabook/master?urlpath=tree/chapters/08/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/UOS-Bigdata/bigdatabook/blob/master/chapters/08/regression.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   8.2.1. 아버지와 아들의 키: 평균들의 관계
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   8.2.2. 최소제곱법
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     8.2.2.1. 최소제곱법의 기준
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     8.2.2.2. 평균제곱오차
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     8.2.2.3. 최소제곱법의 해
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   8.2.3. 선형 회귀모형의 평가
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sklearn">
   8.2.4.
   <code class="docutils literal notranslate">
    <span class="pre">
     SKlearn
    </span>
   </code>
   패키지
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1><span class="section-number">8.2. </span>선형 회귀모형<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>관심있는 반응 변수와 설명변수의 함수적인 관계를 추론하는 경우 사용할 수 있는 가장 단순하고 기본적인 모형은 선형 회귀모형(linear regression model)이다. 선형 회귀모형은  설명변수의 변화에 따른 반응변수의 변화를 선형식으로 나타낸 매우 단순한 모형이다. 이 절에서는 선형 회귀모형을 추정하는 방법을 살펴보기로 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># 한글 폰트가 깨질 때 사용 - 런타임 메뉴에서 다시 시작 및 모두 실행 선택. (출처: https://teddylee777.github.io/colab/colab-korean)
!sudo apt-get install -y fonts-nanum
!sudo fc-cache -fv
!rm ~/.cache/matplotlib -rf
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading package lists... Done
Building dependency tree       
Reading state information... Done
fonts-nanum is already the newest version (20170925-1).
0 upgraded, 0 newly installed, 0 to remove and 37 not upgraded.
/usr/share/fonts: caching, new cache contents: 0 fonts, 1 dirs
/usr/share/fonts/truetype: caching, new cache contents: 0 fonts, 3 dirs
/usr/share/fonts/truetype/humor-sans: caching, new cache contents: 1 fonts, 0 dirs
/usr/share/fonts/truetype/liberation: caching, new cache contents: 16 fonts, 0 dirs
/usr/share/fonts/truetype/nanum: caching, new cache contents: 10 fonts, 0 dirs
/usr/local/share/fonts: caching, new cache contents: 0 fonts, 0 dirs
/root/.local/share/fonts: skipping, no such directory
/root/.fonts: skipping, no such directory
/var/cache/fontconfig: cleaning cache directory
/root/.cache/fontconfig: not cleaning non-existent cache directory
/root/.fontconfig: not cleaning non-existent cache directory
fc-cache: succeeded
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;NanumBarunGothic&#39;</span><span class="p">)</span> <span class="c1"># clolab 에서 한글 사용 </span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># 그림 크기 조정</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2><span class="section-number">8.2.1. </span>아버지와 아들의 키: 평균들의 관계<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>먼저 앞 절에서 살펴본 Francis Galton의  아버지와 아들의 키에 대한 데이터를 먼저 데이터프레임으로 만들자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">url1</span> <span class="o">=</span> <span class="s2">&quot;https://ilovedata.github.io/teaching/bigdata2/data/father-and-son.csv&quot;</span>
<span class="n">father_son_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
<span class="n">father_son_df</span><span class="o">.</span><span class="n">fheight</span> <span class="o">=</span>  <span class="n">father_son_df</span><span class="o">.</span><span class="n">fheight</span><span class="o">*</span><span class="mf">2.54</span>
<span class="n">father_son_df</span><span class="o">.</span><span class="n">sheight</span> <span class="o">=</span>  <span class="n">father_son_df</span><span class="o">.</span><span class="n">sheight</span><span class="o">*</span><span class="mf">2.54</span>
</pre></div>
</div>
</div>
</div>
<p>아버지와 아들의 키는 아래 주어진 산점도에서 나타나는 것처럼 아버지의 키기 증가하면 아들의 키가 증가하는 경향을 보인다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">father_son_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sheight&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f10cc58f2d0&gt;
</pre></div>
</div>
<img alt="../../_images/regression_7_1.png" src="../../_images/regression_7_1.png" />
</div>
</div>
<p>여기서 경향(trend)라는 말에 주의하자. 경향을 보인다는 것은 아버지의 키를 알고 있다면 아들의 키를 정확하게 예측할 수는 없지만 아버지의 키가 증가하면 평균적으로 아들의 키도 증가한다는 것이다.</p>
<p>이렇게 “어떤 경향을 보인다” 라는 말을 통계적으로 어떻게 구체적으로 나타낼 수 있을까?</p>
<p>아버지의 키를  몇 개의 그룹을 나누어서 생각해 보자. 이제 자료를 다음과 같이 나누어 보자.</p>
<ul class="simple">
<li><p>그룹 1: <span class="math notranslate nohighlight">\(140 &lt;\text{아버지의 키} \le 160\)</span></p></li>
<li><p>그룹 2: <span class="math notranslate nohighlight">\(160 &lt; \text{아버지의 키} \le 170\)</span></p></li>
<li><p>그룹 3: <span class="math notranslate nohighlight">\(170 &lt; \text{아버지의 키} \le 180\)</span></p></li>
<li><p>그룹 4: <span class="math notranslate nohighlight">\(180 &lt; \text{아버지의 키} \le 200\)</span></p></li>
</ul>
<p>위와 같이 전체 데이터를 아버지의 키에 따라서 4개의 그룹으로 나누고 아들의 키의 분포가 어떻게 변하는지 살펴보자.</p>
<p>아래에서 사용한 <code class="docutils literal notranslate"><span class="pre">pandas</span></code> 라이브러리의 <code class="docutils literal notranslate"><span class="pre">pd.cut</span></code> 함수는 첫 번째 인자로 주어진 숫자의 벡터나 시리즈를 두 번째 인자로 주어진 리스트나 벡터의 숫자를 이용하여 구간을 나누어 주는 기능을 한다. 두 번쨰 인자로 주어진 <code class="docutils literal notranslate"><span class="pre">[140,</span> <span class="pre">160,</span> <span class="pre">170,</span> <span class="pre">180]</span></code> 은 각 구간의 끝 값을 지정해 주면 선택명령문 <code class="docutils literal notranslate"><span class="pre">include_lowest=False</span></code> 는 구간을 설정할 때 작은 구간값을 포함하지 말라는 의미이다. 즉, 아래 명령문은 다음과 같은 4개의 구간으로 아버지의 키를 그룹화 해준다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">160</span><span class="p">],</span> <span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span> <span class="p">(</span><span class="mi">170</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span> 
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">father_son_df</span><span class="p">[</span><span class="s1">&#39;group1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">father_son_df</span><span class="o">.</span><span class="n">fheight</span><span class="p">,</span> <span class="p">[</span><span class="mi">140</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">father_son_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fheight</th>
      <th>sheight</th>
      <th>group1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>165.223215</td>
      <td>151.836806</td>
      <td>(160, 170]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>160.657388</td>
      <td>160.563662</td>
      <td>(160, 170]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>164.986513</td>
      <td>160.889747</td>
      <td>(160, 170]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>167.011350</td>
      <td>159.492645</td>
      <td>(160, 170]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>155.288564</td>
      <td>163.274070</td>
      <td>(140, 160]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1073</th>
      <td>170.171897</td>
      <td>179.710893</td>
      <td>(170, 180]</td>
    </tr>
    <tr>
      <th>1074</th>
      <td>181.182797</td>
      <td>173.400060</td>
      <td>(180, 200]</td>
    </tr>
    <tr>
      <th>1075</th>
      <td>182.329176</td>
      <td>176.036961</td>
      <td>(180, 200]</td>
    </tr>
    <tr>
      <th>1076</th>
      <td>179.675460</td>
      <td>176.027055</td>
      <td>(170, 180]</td>
    </tr>
    <tr>
      <th>1077</th>
      <td>178.577469</td>
      <td>170.218100</td>
      <td>(170, 180]</td>
    </tr>
  </tbody>
</table>
<p>1078 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">father_son_df</span><span class="o">.</span><span class="n">group1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       (160, 170]
1       (160, 170]
2       (160, 170]
3       (160, 170]
4       (140, 160]
           ...    
1073    (170, 180]
1074    (180, 200]
1075    (180, 200]
1076    (170, 180]
1077    (170, 180]
Name: group1, Length: 1078, dtype: category
Categories (4, interval[int64]): [(140, 160] &lt; (160, 170] &lt; (170, 180] &lt; (180, 200]]
</pre></div>
</div>
</div>
</div>
<p>위에서 아버지의 키의 크기에 따라 나눈 4개의 그룹에 대하여 아버지의 키 평균과 아들의 키 평균을 구해보자.</p>
<p>다음에 나타난 것처럼 그룹렬로 보면 아버지의 키 평균의 증가하면 아들의 키 평균도 증가한다.<br />
4개의 그룹별 평균이 마치 하나의 직선위에 있는 것 처럼 보인다.</p>
<p>전체 데이터의 산점도에서 나타나는 불확실한 경향은 자료를 여러 개의 그룹으로 나누어 두 변수의 그룹별 평균으로 요약하여 보면 평균의 관계는 좀 더 명확하게 나타난다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">group_summary_1</span> <span class="o">=</span> <span class="n">father_son_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;group1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">group_summary_1</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fheight</th>
      <th>sheight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>157.033422</td>
      <td>167.000530</td>
    </tr>
    <tr>
      <th>1</th>
      <td>165.980611</td>
      <td>171.199651</td>
    </tr>
    <tr>
      <th>2</th>
      <td>174.580022</td>
      <td>175.916772</td>
    </tr>
    <tr>
      <th>3</th>
      <td>183.188398</td>
      <td>180.367088</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">group_summary_1</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sheight&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f10cc02df50&gt;
</pre></div>
</div>
<img alt="../../_images/regression_13_1.png" src="../../_images/regression_13_1.png" />
</div>
</div>
<p>다음으로 그룹의 간격을 조금 더 잘게 나누어서 각 그룹의 평균이 어떻게 변하는지 살펴보자.</p>
<p>아래 코드에서 함수 <code class="docutils literal notranslate"><span class="pre">pd.cut</span></code> 의 두 번째 인자로 하나의 정수 <code class="docutils literal notranslate"><span class="pre">bins=10</span></code> 로 주면 주어진 숫자열을  등간격인 <code class="docutils literal notranslate"><span class="pre">k=10</span></code>의 구간으로 나누어 준다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">father_son_df</span><span class="p">[</span><span class="s1">&#39;group2&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">father_son_df</span><span class="o">.</span><span class="n">fheight</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">father_son_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fheight</th>
      <th>sheight</th>
      <th>group1</th>
      <th>group2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>165.223215</td>
      <td>151.836806</td>
      <td>(160, 170]</td>
      <td>(162.397, 166.569]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>160.657388</td>
      <td>160.563662</td>
      <td>(160, 170]</td>
      <td>(158.225, 162.397]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>164.986513</td>
      <td>160.889747</td>
      <td>(160, 170]</td>
      <td>(162.397, 166.569]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>167.011350</td>
      <td>159.492645</td>
      <td>(160, 170]</td>
      <td>(166.569, 170.741]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>155.288564</td>
      <td>163.274070</td>
      <td>(140, 160]</td>
      <td>(154.053, 158.225]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1073</th>
      <td>170.171897</td>
      <td>179.710893</td>
      <td>(170, 180]</td>
      <td>(166.569, 170.741]</td>
    </tr>
    <tr>
      <th>1074</th>
      <td>181.182797</td>
      <td>173.400060</td>
      <td>(180, 200]</td>
      <td>(179.086, 183.258]</td>
    </tr>
    <tr>
      <th>1075</th>
      <td>182.329176</td>
      <td>176.036961</td>
      <td>(180, 200]</td>
      <td>(179.086, 183.258]</td>
    </tr>
    <tr>
      <th>1076</th>
      <td>179.675460</td>
      <td>176.027055</td>
      <td>(170, 180]</td>
      <td>(179.086, 183.258]</td>
    </tr>
    <tr>
      <th>1077</th>
      <td>178.577469</td>
      <td>170.218100</td>
      <td>(170, 180]</td>
      <td>(174.913, 179.086]</td>
    </tr>
  </tbody>
</table>
<p>1078 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">father_son_df</span><span class="o">.</span><span class="n">group2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       (162.397, 166.569]
1       (158.225, 162.397]
2       (162.397, 166.569]
3       (166.569, 170.741]
4       (154.053, 158.225]
               ...        
1073    (166.569, 170.741]
1074    (179.086, 183.258]
1075    (179.086, 183.258]
1076    (179.086, 183.258]
1077    (174.913, 179.086]
Name: group2, Length: 1078, dtype: category
Categories (10, interval[float64]): [(149.839, 154.053] &lt; (154.053, 158.225] &lt; (158.225, 162.397] &lt;
                                     (162.397, 166.569] ... (174.913, 179.086] &lt; (179.086, 183.258] &lt;
                                     (183.258, 187.43] &lt; (187.43, 191.602]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">group_summary_2</span> <span class="o">=</span> <span class="n">father_son_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;group2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">group_summary_2</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fheight</th>
      <th>sheight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>151.778186</td>
      <td>164.266746</td>
    </tr>
    <tr>
      <th>1</th>
      <td>156.395947</td>
      <td>166.528948</td>
    </tr>
    <tr>
      <th>2</th>
      <td>160.678486</td>
      <td>169.238409</td>
    </tr>
    <tr>
      <th>3</th>
      <td>164.750386</td>
      <td>170.586666</td>
    </tr>
    <tr>
      <th>4</th>
      <td>168.611132</td>
      <td>172.252867</td>
    </tr>
    <tr>
      <th>5</th>
      <td>172.840256</td>
      <td>175.327199</td>
    </tr>
    <tr>
      <th>6</th>
      <td>176.902658</td>
      <td>176.889192</td>
    </tr>
    <tr>
      <th>7</th>
      <td>180.899270</td>
      <td>179.205668</td>
    </tr>
    <tr>
      <th>8</th>
      <td>184.504045</td>
      <td>181.519479</td>
    </tr>
    <tr>
      <th>9</th>
      <td>189.708045</td>
      <td>181.022422</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">group_summary_2</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sheight&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f10ca7b9690&gt;
</pre></div>
</div>
<img alt="../../_images/regression_18_1.png" src="../../_images/regression_18_1.png" />
</div>
</div>
<p>위에서 주어진 10개의 구간에 대한 아버지와 아들의 평균 키에 대한 관계는  하나의 직선과 같은 관계를 보인다.</p>
<p>각 구간에 대한 아버지와 아들 키의 평균은 아주 단순한 일차식으로 다음과 같이 나타낼 수 있다.</p>
<div class="math notranslate nohighlight">
\[ \text{mean of son's heights} \approx \beta_0 + \beta_1 (\text{mean of father's height}) \]</div>
<p>이제 위에서 구한 구간의 평균들을 전체 자료의 산점도와 함깨 표시해 보자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">father_son_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sheight&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">group_summary_2</span><span class="o">.</span><span class="n">fheight</span><span class="p">,</span> <span class="n">group_summary_2</span><span class="o">.</span><span class="n">sheight</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x7f10ca66c810&gt;
</pre></div>
</div>
<img alt="../../_images/regression_20_1.png" src="../../_images/regression_20_1.png" />
</div>
</div>
<p>위의 그림에서 나타난 빨간 점들은 주어진 아버지의 키 구간에서 아들의 키들의 평균값을 표시한 것이다. 아버지의 키의 평균과 아들 키의 평균이 직선과 같은 관계를 가지는 것을 알 수 있다.</p>
<p><strong>선형 회귀모형(linear regression model)은 반응변수 <span class="math notranslate nohighlight">\(y\)</span>의 평균이 설명변수 <span class="math notranslate nohighlight">\(x\)</span>의 값에 따라서 직선으로 변하는 것을 나타내는 모형</strong> 이다.</p>
<div class="math notranslate nohighlight">
\[ E(y|x) = \beta_0 + \beta_1 x \]</div>
<p>위의 식에서 <span class="math notranslate nohighlight">\(E(y|x)\)</span>는 설명변수 <span class="math notranslate nohighlight">\(x\)</span>의 값이 주어진 경우 반응변수 <span class="math notranslate nohighlight">\(y\)</span>의 평균(Expectation, Mean)을 의미한다.</p>
</div>
<div class="section" id="id3">
<h2><span class="section-number">8.2.2. </span>최소제곱법<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3><span class="section-number">8.2.2.1. </span>최소제곱법의 기준<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>이제 위에서 주어진 선형 회귀모형에서 직선의 기울기 <span class="math notranslate nohighlight">\(\beta_1\)</span> 과 절편 <span class="math notranslate nohighlight">\(\beta_0\)</span>를 데이터를 이용하여 결정하는 기준과 방법에 대하여 알아보자.</p>
<p>최소제곱법(least square method)은 설명변수의 값 <span class="math notranslate nohighlight">\(x_i\)</span> 에 대하여 실제 관측한 반응변수의 값 <span class="math notranslate nohighlight">\(y_i\)</span>와 선형 회귀직선 위에 있는 값 <span class="math notranslate nohighlight">\(\beta_0 + \beta_1 x_i\)</span> 값이 <strong>가장 가깝게 나타나도록</strong> 기울기 <span class="math notranslate nohighlight">\(\beta_1\)</span> 과 절편 <span class="math notranslate nohighlight">\(\beta_0\)</span>을 결정하는 방법이다.</p>
<p>두 개의 주어진 수가 가장 가깝다는 것을 정하려면  두 수의 거리(distance)를 정의해야 한다.
최소제곱법에서는 거리를 두 수의 차이를 제곱한 값으로 사용한다.</p>
<p>정리하면 반응변수 <span class="math notranslate nohighlight">\(y\)</span>와 설명변수 <span class="math notranslate nohighlight">\(x\)</span>에 대한 <span class="math notranslate nohighlight">\(n\)</span> 개의 자료가 다음과 같이 주어진 경우</p>
<div class="math notranslate nohighlight">
\[ (x_1, y_1), ~ (x_2, y_2), \dots , (x_n, y_n)\]</div>
<p>최소제곱법은 다음과 같은 조건을 만족하는 기울기 <span class="math notranslate nohighlight">\(\beta_1\)</span> 과 절편 <span class="math notranslate nohighlight">\(\beta_0\)</span>의 값을 구하는 방법이다.</p>
<div class="math notranslate nohighlight">
\[ \min_{\beta_0, \beta_1} \frac{1}{n} \sum_{i=1}^n (y_i - [\beta_0 + \beta_1 x_i])^2  \]</div>
<p>위의 식에서 설명변수의 값 <span class="math notranslate nohighlight">\(x_i\)</span> 에 대하여 관측값 <span class="math notranslate nohighlight">\(y_i\)</span> 과 직선 위에 있는 값의 차이를 오차(error)라고 부른다.</p>
<div class="math notranslate nohighlight">
\[ \text{error}_i = y_i - (\beta_0 + \beta_1 x_i) = y_i - E(y_i | x_i) \]</div>
<p>따라서 최소제곱법은 실제 자료와 직선식으로 표현된 평균값의 차이들의 제곱합를 최소화하는 기울기와 절편을 찾는 방법이다.</p>
</div>
<div class="section" id="id5">
<h3><span class="section-number">8.2.2.2. </span>평균제곱오차<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>이제 절편 <span class="math notranslate nohighlight">\(\beta_0 = \beta_{0}^*\)</span> 와 기울기 <span class="math notranslate nohighlight">\(\beta_1 = \beta_1^*\)</span> 로 그 값이 주어진 경우 실제 자료와 직선식으로 표현된 평균값의 차이들의 제곱합을 다음과 같이 나타내면 이 값을 평균제곱오차(Mean Squared Error; mse) 라고 부른다.</p>
<div class="math notranslate nohighlight">
\[ mse(\beta_0^*, \beta_1^*) = \frac{1}{n} \sum_{i=1}^n (y_i - [\beta_0^* + \beta_1^* x_i])^2  = \frac{1}{n} \sum_{i=1}^n  \text{error}_i^2 \]</div>
<p>이제 절편과 기울기가 주어진 경우 주어진 직선의 오차를 그림으로 나타내고 평균제곱오차를 계산해 주는 함수 <code class="docutils literal notranslate"><span class="pre">least_square_error</span></code>를 다음과 같이 정의하여 만들어 보자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">least_squares_error</span><span class="p">(</span> <span class="n">df</span><span class="p">,</span> <span class="n">x_name</span><span class="p">,</span> <span class="n">y_name</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">percent_poiint_errors</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  목적</span>
<span class="sd">    주어진 절편과 기울기를 이용하여 회귀직선을 그리고 최소제곱오차를 계산하는 함수</span>
<span class="sd">  함수의 인자</span>
<span class="sd">    df: 데이터프레임</span>
<span class="sd">    x_name: 데이터프레임에 있는 설명변수의 열이름</span>
<span class="sd">    y_name: 데이터프레임에 있는 반응변수의 열이름</span>
<span class="sd">    intercept: 회귀직선의 절편</span>
<span class="sd">    slope: 회귀직선의 기울기</span>
<span class="sd">    percent_poiint_errors : 오차(빨간 선)를 표시할 데이터의 비율(0과 1사이의 값)</span>

<span class="sd">  출력값: </span>
<span class="sd">    mse: 평균제곱오차</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">df0</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">x_name</span><span class="p">,</span> <span class="n">y_name</span><span class="p">]]</span>
  <span class="n">df0</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_name</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="n">y_name</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
  <span class="n">xlims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df0</span><span class="p">[</span><span class="n">x_name</span><span class="p">])</span><span class="o">*</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df0</span><span class="p">[</span><span class="n">x_name</span><span class="p">])</span><span class="o">*</span><span class="mf">1.05</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xlims</span> <span class="o">+</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  
  <span class="n">n</span> <span class="o">=</span> <span class="n">df0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">show_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">percent_poiint_errors</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span> <span class="p">)</span>
  
  <span class="n">mse</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df0</span><span class="p">)):</span>
    <span class="k">if</span>  <span class="n">show_error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mse</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span> <span class="p">(</span><span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
  <span class="k">return</span><span class="p">(</span><span class="n">mse</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>아래 그림은 다음과 같이 절편이 <span class="math notranslate nohighlight">\(\beta_0=20.0\)</span>, 기울기가 <span class="math notranslate nohighlight">\(\beta_1 = 0.8\)</span> 가 주어진 경우 아버의 키(<span class="math notranslate nohighlight">\(x\)</span>)와 아들의 키(<span class="math notranslate nohighlight">\(y\)</span>0)의 관계를  선형 회귀직선을 나타낸 것이다.</p>
<div class="math notranslate nohighlight">
\[ E(y |x)  = 20.0 + (0.8)x \]</div>
<p>몇 개의 데이터(1%)에서 오차의 크기를 빨간 선으로 나타내었다.</p>
<div class="math notranslate nohighlight">
\[ \text{error}_i = y_i -[20.0 + (0.8)x_i] \]</div>
<p>이 경우 평균제곱오차의 값은 151.042 이다.</p>
<div class="math notranslate nohighlight">
\[ mse(20.0, 0.8) = \frac{1}{n} \sum_{i=1}^n \text{error}_i^2 = 328.397 \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mse_1</span> <span class="o">=</span> <span class="n">least_squares_error</span><span class="p">(</span><span class="n">father_son_df</span><span class="p">,</span> <span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="s1">&#39;sheight&#39;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">mse_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>328.3974546323276
</pre></div>
</div>
<img alt="../../_images/regression_26_1.png" src="../../_images/regression_26_1.png" />
</div>
</div>
<p>이제 아래 그림은   절편이 <span class="math notranslate nohighlight">\(\beta_0=25.0\)</span>, 기울기가 <span class="math notranslate nohighlight">\(\beta_1 = 0.9\)</span> 으로 주어진 경우 아버지의 키(<span class="math notranslate nohighlight">\(x\)</span>)와 아들의 키(<span class="math notranslate nohighlight">\(y\)</span>)의 관계를  선형 회귀직선을 나타낸 것이다.</p>
<div class="math notranslate nohighlight">
\[ \text{error}_i = y_i - [25.0 + (0.9)x_i] \]</div>
<p>이 경우 평균제곱오차의 값은 73.29 이다.</p>
<div class="math notranslate nohighlight">
\[ mse(25.0, 0.9) =  \frac{1}{n} \sum_{i=1}^n \text{error}_i^2 = 73.29 \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mse_2</span> <span class="o">=</span> <span class="n">least_squares_error</span><span class="p">(</span><span class="n">father_son_df</span><span class="p">,</span> <span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="s1">&#39;sheight&#39;</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">mse_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>73.29044331530774
</pre></div>
</div>
<img alt="../../_images/regression_28_1.png" src="../../_images/regression_28_1.png" />
</div>
</div>
</div>
<div class="section" id="id6">
<h3><span class="section-number">8.2.2.3. </span>최소제곱법의 해<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>이렇게 절편과 기울기의 값이 변하면 평균제곱오차의 크기도 변한다. 그러면 평균제곱오차를 최소화하는 최적의 절편과 기울기는 어떻게 구할까?</p>
<p>앞에서 언급한 것과 같이 설명변수(<span class="math notranslate nohighlight">\(x_i\)</span>)와 반응변수(<span class="math notranslate nohighlight">\(y_i\)</span>)의 데이터가 <span class="math notranslate nohighlight">\(n\)</span>개 주어진 경우, 평균제곱오차를 최소화하는 최소제곱법의 해(solution) <span class="math notranslate nohighlight">\(\hat \beta_0\)</span>와 <span class="math notranslate nohighlight">\(\hat \beta_1\)</span> 은 다음과 같이 주어진다.</p>
<div class="math notranslate nohighlight">
\[ \hat \beta_1 = r \frac{SD_y}{SD_x},  \quad \quad \hat \beta_0 = \bar y - \hat \beta_1 \bar x \]</div>
<p>위의 식에서 사용되는 통계량은 다음과 같다.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r\)</span> : 설명변수(<span class="math notranslate nohighlight">\(x_i\)</span>)와 반응변수(<span class="math notranslate nohighlight">\(y_i\)</span>)의 상관계수</p></li>
<li><p><span class="math notranslate nohighlight">\(\bar x\)</span> : 설명변수(<span class="math notranslate nohighlight">\(x_i\)</span>)의 평균</p></li>
<li><p><span class="math notranslate nohighlight">\(\bar y\)</span> : 반응변수(<span class="math notranslate nohighlight">\(y_i\)</span>)의 평균</p></li>
<li><p><span class="math notranslate nohighlight">\(SD_x\)</span> : 설명변수(<span class="math notranslate nohighlight">\(x_i\)</span>)의 표준편차</p></li>
<li><p><span class="math notranslate nohighlight">\(SD_y\)</span> : 반응변수(<span class="math notranslate nohighlight">\(y_i\)</span>)의 평균</p></li>
</ul>
<p>본 강의에서는 평균제곱오차를 최소화하는 최적의 절편과 기울기를 유도하는 자세한 방법은 배우지 않을 것이다.</p>
<p>이제  최소제곱법의 해(solution) <span class="math notranslate nohighlight">\(\hat \beta_0\)</span>와 <span class="math notranslate nohighlight">\(\hat \beta_1\)</span> 을 구하는 함수 <code class="docutils literal notranslate"><span class="pre">least_square_fit</span></code>을 정의해 보자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">least_squares_fit</span><span class="p">(</span> <span class="n">df</span><span class="p">,</span> <span class="n">x_name</span><span class="p">,</span> <span class="n">y_name</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  목적</span>
<span class="sd">    주어진 자료를 이용하여 최소제곱 절편과 기울기 계산하는 함수</span>
<span class="sd">  함수의 인자</span>
<span class="sd">    df: 데이터프레임</span>
<span class="sd">    x_name: 데이터프레임에 있는 설명변수의 열이름</span>
<span class="sd">    y_name: 데이터프레임에 있는 반응변수의 열이름</span>
<span class="sd">  출력값: </span>
<span class="sd">    b0: 절편</span>
<span class="sd">    b1: 기울기</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_name</span><span class="p">])</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">y_name</span><span class="p">])</span>
  <span class="n">x_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">y_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="n">SD_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">SD_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

  <span class="n">x_st</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_bar</span><span class="p">)</span><span class="o">/</span><span class="n">SD_x</span>
  <span class="n">y_st</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_bar</span><span class="p">)</span><span class="o">/</span><span class="n">SD_y</span>

  <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">x_st</span> <span class="o">*</span> <span class="n">y_st</span> <span class="p">)</span><span class="o">/</span><span class="n">n</span>
  
  <span class="n">b1</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">SD_y</span><span class="o">/</span><span class="n">SD_x</span>
  <span class="n">b0</span> <span class="o">=</span> <span class="n">y_bar</span> <span class="o">-</span> <span class="n">b1</span><span class="o">*</span><span class="n">x_bar</span>

  <span class="k">return</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span><span class="n">b1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>이제 위에서 구한 최소제곱법으로 구한 절편과 기울기의 추정량 <span class="math notranslate nohighlight">\(\hat \beta_0\)</span>과 <span class="math notranslate nohighlight">\(\hat \beta_1\)</span>을 구해보자.</p>
<div class="math notranslate nohighlight">
\[ \min_{\beta_0, \beta_1} \frac{1}{n} \sum_{i=1}^n (y_i - [\beta_0 + \beta_1 x_i])^2 =  \frac{1}{n} \sum_{i=1}^n (y_i - [\hat \beta_0 + \hat \beta_1 x_i])^2  \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">beta0</span><span class="p">,</span> <span class="n">beta1</span><span class="p">)</span> <span class="o">=</span> <span class="n">least_squares_fit</span><span class="p">(</span><span class="n">father_son_df</span><span class="p">,</span> <span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="s1">&#39;sheight&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">beta0</span><span class="p">,</span> <span class="n">beta1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(86.07197505935797, 0.5140930386233075)
</pre></div>
</div>
</div>
</div>
<p>기울기의 추정량은 <span class="math notranslate nohighlight">\(\hat \beta_1= 0.514\)</span>로 상관계수의 값과 매우 유사하다. 아버지와 아들의 키에 대한 표준편차가 거의 동일하기 때문에 이 경우 기울기의 추정량은 상관계수와 기울기는 거의 같다.</p>
<p>최소제곱 추정량(least square estimator) <span class="math notranslate nohighlight">\(\hat \beta_0\)</span>과 <span class="math notranslate nohighlight">\(\hat \beta_1\)</span> 에서의 평균제곱오차는 다음의 코드에서 함수  <code class="docutils literal notranslate"><span class="pre">least_squares_error</span></code> 로 구할 수 있다.</p>
<p>절편과 기울기의 최소제곱 추정량 <span class="math notranslate nohighlight">\(\hat \beta_0\)</span>과 <span class="math notranslate nohighlight">\(\hat \beta_1\)</span> 으로 부터 얻은 평균제곱오차의 값 38.23은 모든 경우에 대한 최소값이다. 즉, 절편과 기울기가  <span class="math notranslate nohighlight">\(\hat \beta_0\)</span>과 <span class="math notranslate nohighlight">\(\hat \beta_1\)</span> 와 다른 값을 가지는 경우 평균제곱오차는 38.23보다 크다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mse_best</span> <span class="o">=</span> <span class="n">least_squares_error</span><span class="p">(</span><span class="n">father_son_df</span><span class="p">,</span> <span class="s1">&#39;fheight&#39;</span><span class="p">,</span> <span class="s1">&#39;sheight&#39;</span><span class="p">,</span> <span class="n">beta0</span><span class="p">,</span> <span class="n">beta1</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span>
<span class="n">mse_best</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38.23082448512249
</pre></div>
</div>
<img alt="../../_images/regression_34_1.png" src="../../_images/regression_34_1.png" />
</div>
</div>
<p>아버지의 키(<span class="math notranslate nohighlight">\(x\)</span>)와 아들의 키(<span class="math notranslate nohighlight">\(y\)</span>)의 관계를 선형 회귀모형으로 나타낼 때 추정된 회귀직선은 다음과 같다.</p>
<div class="math notranslate nohighlight">
\[ E(y|x) = 86.07 + (0.51) x \]</div>
<p>위의 식은 아버지의 키가 1cm 증가하면 아들 키의 평균이 0.51 cm 증가한다는 의미이다.</p>
<p>위에서 추정된 식은 아버지의 키가 주어진 경우 아들의 키에 대한 예측에 사용할 수 있다. 예를 들어 아버지의 키가 185.0 cm 인 경우 <strong>아들의 평균적인 키</strong> 는 다음과 같이 예측할 수 있다.</p>
<div class="math notranslate nohighlight">
\[ E(y | x = 185.0) = 86.07 + (0.51) (185.0) =  181.2 \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span><span class="o">*</span><span class="mf">185.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>181.17918720466986
</pre></div>
</div>
</div>
</div>
<p>위의 추정된 회귀직선을 사용할 때 유의할 점은 주어진 아들의 키에 대한 예측값은 <strong>아들의 평균적인 키에 대한 예측값</strong> 이라는 것이다. 위에서 구한 회귀직선은 주어진 설명변수 <span class="math notranslate nohighlight">\(x\)</span> 에 대한 반응변수 <span class="math notranslate nohighlight">\(y\)</span>의 평균을 나타내는 직선이며 실제 관측한 반응변수의 값들은 직선을 중심으로 퍼져있다.</p>
</div>
</div>
<div class="section" id="id7">
<h2><span class="section-number">8.2.3. </span>선형 회귀모형의 평가<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>위에서 아버지와 아들의 키의 관계를 선형 회귀모형으로 나타내는 경우, 실제 관측값들은 추정된 회귀직선 주위에 퍼져서 나타난다. 추정된 회귀직선으로 부터 반응변수의 관측값들이 퍼진 정도가 작아지면 회귀모형이 반응변수와 설명변수의 관계를 더욱 잘 설명하는것으로 판단할 수 있다.</p>
<p>다음 두 개의 데이터와 각각 추정된 회귀직선을 비교해 보자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111121</span><span class="p">)</span>

<span class="n">n</span><span class="o">=</span><span class="mi">20</span>

<span class="n">sigma1</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">df_reg_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
<span class="n">df_reg_1</span><span class="p">[</span><span class="s2">&quot;case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Large errors&quot;</span>

<span class="n">sigma2</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma2</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">df_reg_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
<span class="n">df_reg_2</span><span class="p">[</span><span class="s2">&quot;case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Small errors&quot;</span>

<span class="n">df_reg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_reg_1</span><span class="p">,</span><span class="n">df_reg_2</span> <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df_reg</span><span class="p">,</span>  <span class="n">col</span><span class="o">=</span><span class="s2">&quot;case&quot;</span><span class="p">,</span> <span class="n">margin_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">5.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7f10c19f1e90&gt;
</pre></div>
</div>
<img alt="../../_images/regression_40_1.png" src="../../_images/regression_40_1.png" />
</div>
</div>
<p>첫번째 그림과 두 번째 그림을 비교하면 두 번째 데이터에서 적합한 선형 회귀모형이 첫 번째 데이터의 모형보다 오차(error)가 더 작은 것을 알 수 있다.</p>
<div class="math notranslate nohighlight">
\[ \text{error}_i = y_i - (\hat \beta_0 + \hat \beta_1 x_i)  \]</div>
<p>오차가 작을수록 회귀모형이 두 변수의 관계를 설명하는 능력이 더 뛰어나다는 것을 의미한다. 따라서 평균오차제곱합 <span class="math notranslate nohighlight">\(mse\)</span>가 작을 수록 관계를 더 잘 설명하는 모형이다.</p>
<div class="math notranslate nohighlight">
\[  mse = \frac{1}{n}  \sum_{i=1}^n \text{error}_i^2 \]</div>
<p>하지만 평균오차제곱합 <span class="math notranslate nohighlight">\(mse\)</span>는 자료의 단위에 따라서 변화되는 측도이므로 이를 단위에 따라서 변하지 않게 표준화시켜야지 서로 다른 회귀직선의 설명력과 서로 비교할 수 있다.</p>
<p>선형 회귀모형이 <strong>설명변수와 반응변수의 관계를 설명하는 능력에 대하여 평가하는 측도를 결정계수(coefficient of determination; <span class="math notranslate nohighlight">\(R^2\)</span>)</strong> 라고 하며  평균제곱오차 <span class="math notranslate nohighlight">\(mse\)</span> 와 반응변수의 분산 <span class="math notranslate nohighlight">\(SD_y^2\)</span> 을 이용하여 다음과 같은 정의한다.</p>
<div class="math notranslate nohighlight">
\[ R^2 = 1- \frac{mse}{SD^2_y} \]</div>
<p>결정계수는 0과 1의 값을 가지면 보통 백분율로 표시한다. 결정계수의 값이 클수록 선형 회귀모형이 설명변수와 반응변수의 관계를 설명하는 능력이 커진다.</p>
<p>아래에서 두 자료에서의 결정계수를 비교하면 첫 번째 자료에 대한 선형 회귀모형의 결정계수는 5.5% 이고 두 번째 자료에 대해서는 74.6 %이다. 따라서 두 번째 자료에 대한 회귀모형의 설명력이 더 크다고 평가할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">reg_1_beta0</span><span class="p">,</span> <span class="n">reg_1_beta1</span><span class="p">)</span> <span class="o">=</span> <span class="n">least_squares_fit</span><span class="p">(</span><span class="n">df_reg_1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">mse_reg_1</span> <span class="o">=</span> <span class="n">least_squares_error</span><span class="p">(</span><span class="n">df_reg_1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">reg_1_beta0</span><span class="p">,</span> <span class="n">reg_1_beta1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_reg_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26.971200022915433
</pre></div>
</div>
<img alt="../../_images/regression_43_1.png" src="../../_images/regression_43_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">reg_2_beta0</span><span class="p">,</span> <span class="n">reg_2_beta1</span><span class="p">)</span> <span class="o">=</span> <span class="n">least_squares_fit</span><span class="p">(</span><span class="n">df_reg_2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">mse_reg_2</span> <span class="o">=</span> <span class="n">least_squares_error</span><span class="p">(</span><span class="n">df_reg_2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">reg_2_beta0</span><span class="p">,</span> <span class="n">reg_2_beta1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_reg_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6519429797067264
</pre></div>
</div>
<img alt="../../_images/regression_44_1.png" src="../../_images/regression_44_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#결정 계수의 계산</span>
<span class="n">R2_reg_1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mse_reg_1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df_reg_1</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2_reg_2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mse_reg_2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df_reg_2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2_reg_1</span><span class="p">,</span> <span class="n">R2_reg_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.05540917626273012, 0.7466063931874196)
</pre></div>
</div>
</div>
</div>
<p>아버지와 아들에 키에 대한 자료에서 선형 회귀모형의 설명력은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">-</span> <span class="n">mse_best</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">father_son_df</span><span class="o">.</span><span class="n">sheight</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2513401022491375
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sklearn">
<h2><span class="section-number">8.2.4. </span><code class="docutils literal notranslate"><span class="pre">SKlearn</span></code> 패키지<a class="headerlink" href="#sklearn" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">SKlearn</span></code> 패키지는 기계학습에서 이용되는 다양한 모형들을 모아놓은 패키지이다.</p>
<p>다음은 아버지와 아들의 키 자료에 대하여 <code class="docutils literal notranslate"><span class="pre">SKlearn</span></code> 패키지의 <code class="docutils literal notranslate"><span class="pre">linear_model</span></code> 라이브러리를 이용하여 위에서 배운 선형 회귀모형을 적합하고 여러 가지 통계량을 얻을 수 있는 코드이다.</p>
<p><code class="docutils literal notranslate"><span class="pre">SKlearn</span></code> 패키지의 <code class="docutils literal notranslate"><span class="pre">linear_model</span></code> 라이브러리를 이용하기 위해서는 데이터프레임으로 저장된 자료를 <code class="docutils literal notranslate"><span class="pre">numpy</span></code> 의 행렬 형식으로 바꾸어야 한다. 또한 설명변수가 1개인 경우 <span class="math notranslate nohighlight">\((-1,1)\)</span> 사이의 값으으로 변화시켜주어야 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 설명변수 지정 - 설변변수가 1개이므로 (-1,1) 사이의 값으로 변환</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">father_son_df</span><span class="p">[</span><span class="s1">&#39;fheight&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># 반응변수 지정</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">father_son_df</span><span class="p">[</span><span class="s1">&#39;sheight&#39;</span><span class="p">])</span>
<span class="c1"># 선형 회귀모형의 지정</span>
<span class="n">reg_model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="c1"># 선형회귀모형을 최소제고법으로 적합</span>
<span class="n">reg_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="c1"># 회귀직선 계산</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">reg_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># 절편과 기울기의 추정량</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;절편(intercept): &quot;</span><span class="p">,</span> <span class="n">reg_model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;기울기(slope): &quot;</span><span class="p">,</span> <span class="n">reg_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="c1"># 평균제곱오차</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;평균제곱오차, mse: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="c1"># 결정계수</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;결정계수 R^2: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>절편(intercept):  86.07197505935792
기울기(slope):  [0.51409304]
평균제곱오차, mse: 38.23
결정계수 R^2: 0.25
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/08"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="correlation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">8.1. </span>두 변수의 관계</p>
        </div>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By 서울시립대학교<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>